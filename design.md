## Домашняя работа 1. Архитектура CLI

### Участники группы

* Носивской Владислав
* Саврасов Михаил
* Левин Лев
* Широков Кирилл

### Структурная диаграмма

TODO: Вставить картинку новой диаграммы

### Правила для лексера и парсера

В этой части будут расписаны формальные правила для лексера и парсера,
которые программист перенесет в код (как именно -- будет расписано
позднее)

Синтаксис отсылается к использованию библиотеки `yecc` (`yacc` для Erlang)

Есть отдельный парсер для команд и для аргументов. Это сделано, чтобы
передавать в парсер аргументов вывод команд при перебрасывании вывода в пайпе.


* Лексер

```
Definitions.

WORD = [$_a-zA-Z][$_a-zA-Z0-9]*
WHITESPACE = [\s\t\n\r]

Rules.

|             : pipe.
=             : assign.
"             : double_quote.
[^"]*         : double_quote_interior.
'             : single_quote.
[^']*         : single_quote_interior.
exit          : exit_token.
{WORD}        : word.
{WHITESPACE}+ : skip_token.
```

* Парсер команд (Оставляет аргументы как есть)

```
Nontermials command, assignment, atom, function, var_name, args.
Terminals pipe, word, double_quote, double_quote_interior, single_quote, single_quote_interior.
Rootsymbol command.

Left pipe. (Левоасс. оператор)

command -> command pipe command.
command -> assignment.
command -> atom.
command -> exit_token.
command -> word. (Благодаря этому работает пример с $x$y)

assignment -> var_name assign word.

atom -> function.
atom -> function args.

args -> arg.
args -> arg args.

arg -> word.
arg -> double_quote double_quote_interior double_quote.
arg -> single_quote single_quote_interior single_quote.

var_name -> word.
function -> word.
```

## Архитектурные сущности

### CLI

Основной компонент для взаимодействия с консолью

Методы:

* Чтение строки из консоли
* Вывести строку в консоль
* Геттеры / Сеттеры для потоков ввода/вывода/ошибок


### Lexer

Лексер для токенизации строки. Возвращает список токенов и остаток строки, который
не получилось разобрать.

Правила для лексера описаны выше, от программиста требуется перевести 
правила в код, согласно формату библиотеки [PLY](https://github.com/dabeaz/ply).

### CommandParser

Парсер для первичной обработки команды. Принимает список токенов, возвращает
AST, построенное с помощью библиотеки [PLY](https://github.com/dabeaz/ply)
по грамматике, приведенной выше.

На выходе AST является полностью разобранной командой.

### EnvironmentHandler

Компонент, отвечающий за работу с переменными среды. Хранит внутренние
переменные, которые ввел пользователь.

По имени переменной выдает значение. Если не удалось найти переменную
во внутреннем состоянии -- обращается к системе и просит значение переменной.

Кроме получения переменной по имени должен поддерживать прием строки, внутри которой
все переменные заменяются на свои значения.


### FunctionsHandler

Компонент, хранящий наши реализации команд и вызывающий команду с переданными аргументами.

В случае, если не нашлась наша реализация, просит у системы выполнить команду с такими аргументами.

Метод исполнения должен возвращать пару из кода исполнения и потока выходных данных.
Корректно завершенный вызов имеет код 0, некорректно завершенный вызов внешней функции имеет
код, который передала система; некорректно завершенный вызов внутренней функции имеет код не равный нулю
на усмотрение разработчика


### Substitute

Производит подстановки переменных.

Ищет очередной оператор `$` в строке и жадно набирает имя переменной 
до пробельного символа или другого оператора `$`. После чего производит подстановку
с помощью `EnvironmentHandler`.

В качестве входа может принимать либо строчку, либо AST, которое обходит
и производит замены во всех нодах, в которых замена возможна.


### ASTWalker

Компонент, содержащий основную логику исполнения команды.
Принимает AST, которое нужно обойти и выполнить.

В частности, при перебрасывании вывода одной команды на вход другой,
необходимо вызвать лексер и парсер аргументов. Также необходимо не забыть
вызвать модуль `Substitute` для подстановки переменных при передаче аргументов через пайп.


### Main

Главный модуль.

Производит взаимодействие с `CLI`.
Принятую строку проводит через лексер и парсер, после чего отдает в `ASTWalker`.
